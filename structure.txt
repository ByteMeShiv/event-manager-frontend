 index.html
â”‚   README.md
â”‚   
â”œâ”€â”€â”€.github
â”‚   â””â”€â”€â”€workflows
â”‚           static.yml
â”‚
â”œâ”€â”€â”€css
â”‚       style.css
â”‚
â””â”€â”€â”€js
        api.js
        app.js

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Manager - Vanilla JS</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <header>
        <h1>Event Manager</h1>
        <button id="logout-btn" style="display:none;">Logout</button>
    </header>

    <main>
        <section id="login-container" style="display: none;">
            <h2>Log In</h2>
            <form id="login-form">
                <input type="text" id="username" name="username" placeholder="Username" required><br>
                <input type="password" id="password" name="password" placeholder="Password" required><br>
                <button type="submit">Log In</button>
                <p id="login-message" style="color: red;"></p>
            </form>
        </section>

        <section id="app-container" style="display: none;">
            <h3>Create New Event</h3>
            <form id="create-event-form">
                <input type="text" name="title" placeholder="Title" required><br>
                <textarea name="description" placeholder="Description" required></textarea><br>
                <input type="text" name="location" placeholder="Location" required><br>
                <label>Start Time: <input type="datetime-local" name="start_time" required></label><br>
                <label>End Time: <input type="datetime-local" name="end_time"></label><br>
                <label>Public: <input type="checkbox" name="is_public" checked></label><br>
                <button type="submit">Create Event</button>
            </form>
            
            <hr>
            
            <div id="event-list">
                </div>
        </section>
    </main>

    <script type="module" src="js/api.js"></script>
    <script type="module" src="js/app.js"></script>
</body>
</html>

// js/api.js

// ðŸš€ FINAL PRODUCTION URL ðŸš€
// Uses your provided PythonAnywhere domain with the /api/ prefix
const API_BASE_URL = 'https://thesarcasticone69.pythonanywhere.com/api'; 

// --- Helper Functions ---

// Gets the Authorization header for secure requests
const getAuthHeaders = () => {
    const token = localStorage.getItem('access_token');
    let headers = { 'Content-Type': 'application/json' };
    if (token) {
        // Includes the Bearer token for JWT Authentication
        headers['Authorization'] = `Bearer ${token}`; 
    }
    return headers;
};

// Base wrapper for all Fetch calls
const fetchData = async (endpoint, options = {}) => {
    const url = `${API_BASE_URL}${endpoint}`;
    
    // Merge default and custom headers
    options.headers = { ...getAuthHeaders(), ...options.headers };

    const response = await fetch(url, options);
    
    // Handle error responses
    if (!response.ok) {
        let errorData = { message: response.statusText };
        try {
            errorData = await response.json();
        } catch (e) {
            // response body wasn't JSON
        }
        // Throw a structured error
        throw new Error(`API Error ${response.status}: ${JSON.stringify(errorData)}`);
    }

    // Handle 204 No Content
    if (response.status === 204) {
        return null;
    }
    
    return response.json();
};

// --- Authentication Functions ---

export const loginUser = async (username, password) => {
    const options = {
        method: 'POST',
        body: JSON.stringify({ username, password }) 
    };
    // Endpoint: /api/token/
    const data = await fetchData('/token/', options);
    
    // Store tokens locally upon successful login
    localStorage.setItem('access_token', data.access);
    localStorage.setItem('refresh_token', data.refresh);

    return data;
};

export const logoutUser = () => {
    localStorage.removeItem('access_token');
    localStorage.removeItem('refresh_token');
};

// --- Event Functions ---

export const fetchEvents = async () => {
    // Endpoint: /api/events/
    // Uses optional Auth header, works for public and authenticated users
    return fetchData('/events/');
};

export const createEvent = async (eventData) => {
    const options = {
        method: 'POST',
        body: JSON.stringify(eventData) 
    };
    // Endpoint: /api/events/
    // Requires Auth header (user must be logged in)
    return fetchData('/events/', options);
};

// js/app.js
import { loginUser, logoutUser, fetchEvents, createEvent } from './api.js';

// DOM Elements
const loginForm = document.getElementById('login-form');
const logoutBtn = document.getElementById('logout-btn');
const eventListContainer = document.getElementById('event-list');
const loginContainer = document.getElementById('login-container');
const appContainer = document.getElementById('app-container');
const createEventForm = document.getElementById('create-event-form');
const loginMessage = document.getElementById('login-message');


// --- State Check & UI Update ---

const checkAuthState = () => {
    const token = localStorage.getItem('access_token');
    
    if (token) {
        loginContainer.style.display = 'none';
        appContainer.style.display = 'block';
        logoutBtn.style.display = 'inline';
        loginMessage.textContent = ''; 
        loadEvents();
    } else {
        loginContainer.style.display = 'block';
        appContainer.style.display = 'none';
        logoutBtn.style.display = 'none';
        eventListContainer.innerHTML = '<p>Please log in to see events and access features.</p>';
    }
};

// --- Data Loading & Rendering ---

const renderEvent = (event) => {
    // Renders one event card using data fields from the serializer
    return `
        <div class="event-card">
            <h3>${event.title}</h3>
            <p><strong>Organizer:</strong> ${event.organizer}</p>
            <p><strong>When:</strong> ${new Date(event.start_time).toLocaleString()}</p>
            <p><strong>Attendees:</strong> ${event.rsvps_count}</p>
            <p>${event.description.substring(0, 100)}...</p>
        </div>
    `;
};

const loadEvents = async () => {
    eventListContainer.innerHTML = '<p>Loading events...</p>';
    try {
        const data = await fetchEvents();
        
        if (data.results && data.results.length > 0) {
            let html = data.results.map(renderEvent).join('');
            eventListContainer.innerHTML = html;
        } else {
            eventListContainer.innerHTML = '<p>No events found.</p>';
        }

    } catch (error) {
        console.error('Failed to load events:', error);
        eventListContainer.innerHTML = '<p style="color: red;">Error loading events. Check console for details (CORS/Network error likely).</p>';
    }
};

// --- Event Handlers ---

loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const username = e.target.username.value;
    const password = e.target.password.value;
    loginMessage.textContent = 'Logging in...';

    try {
        await loginUser(username, password);
        // Success
        checkAuthState();
    } catch (error) {
        // Failure
        console.error('Login Failed:', error);
        loginMessage.textContent = 'Login failed. Invalid credentials or API error.';
    }
});

logoutBtn.addEventListener('click', () => {
    logoutUser();
    checkAuthState();
});

createEventForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    // Serialize form data into an object matching the Django EventSerializer
    const eventData = {
        title: e.target.title.value,
        description: e.target.description.value,
        location: e.target.location.value,
        start_time: e.target.start_time.value,
        end_time: e.target.end_time.value,
        is_public: e.target.is_public.checked,
    };
    
    try {
        const newEvent = await createEvent(eventData);
        alert(`Event "${newEvent.title}" created successfully!`);
        e.target.reset(); // Clear form
        loadEvents(); // Reload list to show the new event
    } catch (error) {
        console.error('Event Creation Failed:', error);
        alert('Failed to create event. Check console. Are you logged in?');
    }
});

// --- Initialization ---
document.addEventListener('DOMContentLoaded', checkAuthState);

/* css/style.css */
body {
    font-family: sans-serif;
    margin: 0;
    padding: 0;
    background-color: #f4f4f9;
    color: #333;
}

header {
    background-color: #007bff;
    color: white;
    padding: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

main {
    padding: 20px;
    max-width: 800px;
    margin: 0 auto;
}

#login-container, #app-container {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 20px;
}

input[type="text"], input[type="password"], input[type="datetime-local"], textarea {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

button {
    padding: 10px 15px;
    margin-right: 10px;
    border-radius: 4px;
    cursor: pointer;
    border: none;
    font-weight: bold;
}

#login-form button, #create-event-form button {
    background-color: #28a745;
    color: white;
}

#logout-btn {
    background-color: #dc3545;
    color: white;
}

.event-card {
    border: 1px solid #ddd;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 6px;
    background-color: #fff;
}

label {
    display: block;
    margin-bottom: 10px;
}

